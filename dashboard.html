<!DOCTYPE html>
<html>
<head>
  <title>Real Estate Investment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f0f0f, #1c1c1c);
      color: white;
    }

    .container {
      max-width: 500px;
      margin: auto;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
    }

    .card {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.4);
    }

    .balance {
      font-size: 36px;
      font-weight: bold;
      color: #00ff88;
      margin-top: 10px;
    }

    input {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: none;
      margin-top: 10px;
      margin-bottom: 10px;
      background: #2a2a2a;
      color: white;
    }

    button {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(90deg, #00ff88, #00c853);
      color: black;
      font-weight: bold;
      cursor: pointer;
    }

    .logout {
      background: linear-gradient(90deg, #ff3b3b, #b00020);
      color: white;
      margin-top: 20px;
    }

    .history-item {
      padding: 8px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      font-size: 14px;
    }

    .section-title {
      font-size: 14px;
      color: #aaa;
      margin-bottom: 10px;
    }
  </style>
</head>

<body>

<div class="container">

  <h1>Real Estate Investment</h1>

  <div class="card">
    <div class="section-title">ACCOUNT</div>
    <div>Email: <span id="userEmail"></span></div>
    <div class="balance">$<span id="balance">0.00</span></div>
  </div>

  <div class="card">
    <div class="section-title">DEPOSIT</div>
    <input type="number" id="depositAmount" placeholder="Enter amount">
    <button onclick="makeDeposit()">Request Deposit</button>
  </div>

  <div class="card">
    <div class="section-title">WITHDRAW</div>
    <input type="number" id="withdrawAmount" placeholder="Enter amount">
    <button onclick="makeWithdraw()">Request Withdrawal</button>
  </div>

  <div class="card">
    <div class="section-title">TRANSACTIONS</div>
    <div id="history"></div>
  </div>

  <button class="logout" onclick="logout()">Logout</button>

</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { 
    getFirestore, doc, setDoc, collection, addDoc, 
    onSnapshot, query, where 
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDmUL2bFsNdyBbTWMrnY-yaKI8hAWqLynI",
    authDomain: "real-estate-investment-360d2.firebaseapp.com",
    projectId: "real-estate-investment-360d2",
    storageBucket: "real-estate-investment-360d2.firebasestorage.app",
    messagingSenderId: "459495660687",
    appId: "1:459495660687:web:2595afa1e611a9757364fa",
    measurementId: "G-9FTJ7LMDJD"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const userEmail = document.getElementById("userEmail");
  const balanceEl = document.getElementById("balance");
  const historyDiv = document.getElementById("history");

  let currentUser;

  function animateBalance(target) {
    let start = 0;
    const duration = 600;
    const increment = target / (duration / 16);

    const counter = setInterval(() => {
      start += increment;
      if (start >= target) {
        balanceEl.textContent = target.toFixed(2);
        clearInterval(counter);
      } else {
        balanceEl.textContent = start.toFixed(2);
      }
    }, 16);
  }

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "index.html";
      return;
    }

    currentUser = user;
    userEmail.textContent = user.email;

    const userRef = doc(db, "users", user.email);

    // ðŸ”¥ REAL-TIME BALANCE LISTENER
    onSnapshot(userRef, (docSnap) => {
      if (!docSnap.exists()) {
        setDoc(userRef, { balance: 0 });
      } else {
        const liveBalance = docSnap.data().balance || 0;
        animateBalance(liveBalance);
      }
    });

    // ðŸ”¥ REAL-TIME DEPOSITS
    const depositQuery = query(
      collection(db, "deposits"),
      where("email", "==", user.email)
    );

    onSnapshot(depositQuery, (snapshot) => {
      loadHistory(snapshot.docs);
    });

    // ðŸ”¥ REAL-TIME WITHDRAWALS
    const withdrawQuery = query(
      collection(db, "withdrawals"),
      where("email", "==", user.email)
    );

    onSnapshot(withdrawQuery, (snapshot) => {
      loadHistory();
    });
  });

  window.makeDeposit = async function() {
    const amount = Number(document.getElementById("depositAmount").value);
    if (!amount) return alert("Enter amount");

    await addDoc(collection(db, "deposits"), {
      email: currentUser.email,
      amount: amount,
      status: "Pending"
    });
  };

  window.makeWithdraw = async function() {
    const amount = Number(document.getElementById("withdrawAmount").value);
    if (!amount) return alert("Enter amount");

    await addDoc(collection(db, "withdrawals"), {
      email: currentUser.email,
      amount: amount,
      status: "Pending"
    });
  };

  function loadHistory() {
    historyDiv.innerHTML = "";

    const depositQuery = query(
      collection(db, "deposits"),
      where("email", "==", currentUser.email)
    );

    onSnapshot(depositQuery, (snapshot) => {
      historyDiv.innerHTML = "";
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        historyDiv.innerHTML += 
          `<div class="history-item">Deposit: $${data.amount} (${data.status})</div>`;
      });
    });

    const withdrawQuery = query(
      collection(db, "withdrawals"),
      where("email", "==", currentUser.email)
    );

    onSnapshot(withdrawQuery, (snapshot) => {
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        historyDiv.innerHTML += 
          `<div class="history-item">Withdraw: $${data.amount} (${data.status})</div>`;
      });
    });
  }

  window.logout = function() {
    signOut(auth).then(() => {
      window.location.href = "index.html";
    });
  };

</script>

</body>
</html>