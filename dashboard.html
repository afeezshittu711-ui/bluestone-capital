<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
</head>
<body>

<h1>Investment Dashboard</h1>

<p>Email: <span id="userEmail"></span></p>
<p>Balance: $<span id="balance">0</span></p>

<hr>

<h3>Request Deposit</h3>
<input type="number" id="depositAmount" placeholder="Enter amount">
<button onclick="requestDeposit()">Submit</button>

<h3>Your Deposits</h3>
<div id="depositList"></div>

<hr>

<h3>Request Withdrawal</h3>
<input type="number" id="withdrawAmount" placeholder="Enter amount">
<button onclick="requestWithdrawal()">Withdraw</button>

<h3>Your Withdrawals</h3>
<div id="withdrawList"></div>

<button onclick="logout()">Logout</button>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, getDoc, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;

onAuthStateChanged(auth, async (user) => {

  if (!user) {
    window.location.href = "login.html";
    return;
  }

  currentUser = user;
  document.getElementById("userEmail").innerText = user.email;

  const userRef = doc(db, "users", user.uid);
  const userSnap = await getDoc(userRef);

  if (userSnap.exists()) {
    document.getElementById("balance").innerText = userSnap.data().balance || 0;
  }

  loadDeposits();
  loadWithdrawals();
});

window.requestDeposit = async function () {
  const amount = parseFloat(document.getElementById("depositAmount").value);

  if (!amount || amount <= 0) {
    alert("Enter valid amount");
    return;
  }

  await addDoc(collection(db, "deposits"), {
    userId: currentUser.uid,
    amount: amount,
    status: "pending",
    date: new Date()
  });

  alert("Deposit request submitted");
  document.getElementById("depositAmount").value = "";
  loadDeposits();
};

window.requestWithdrawal = async function () {
  const amount = parseFloat(document.getElementById("withdrawAmount").value);

  if (!amount || amount <= 0) {
    alert("Enter valid amount");
    return;
  }

  await addDoc(collection(db, "withdrawals"), {
    userId: currentUser.uid,
    amount: amount,
    status: "pending",
    date: new Date()
  });

  alert("Withdrawal request submitted");
  document.getElementById("withdrawAmount").value = "";
  loadWithdrawals();
};

async function loadDeposits() {
  const q = query(collection(db, "deposits"), where("userId", "==", currentUser.uid));
  const snapshot = await getDocs(q);

  const list = document.getElementById("depositList");
  list.innerHTML = "";

  snapshot.forEach(doc => {
    const data = doc.data();
    list.innerHTML += `<p>$${data.amount} - ${data.status}</p>`;
  });
}

async function loadWithdrawals() {
  const q = query(collection(db, "withdrawals"), where("userId", "==", currentUser.uid));
  const snapshot = await getDocs(q);

  const list = document.getElementById("withdrawList");
  list.innerHTML = "";

  snapshot.forEach(doc => {
    const data = doc.data();
    list.innerHTML += `<p>$${data.amount} - ${data.status}</p>`;
  });
}

window.logout = function () {
  signOut(auth);
};

</script>

</body>
</html>